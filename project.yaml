version: '3.0'

expectations:
  population_size: 1000

actions:

  
  generate_study_population_conscious_level_blood_pressure:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-03-01 to 2020-04-01 by month"
      --output-file=output/input_conscious_level_blood_pressure.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=altered_conscious_level,blood_pressure
      --param include_hospital_admissions=True
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_conscious_level_blood_pressure*.csv

  generate_study_population_clinical_concern_dehydration:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-03-01 to 2020-04-01 by month"
      --output-file=output/input_clinical_concern_dehydration.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=causing_clinical_concern,clinical_concern_note,dehydration_or_shock
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_clinical_concern_dehydration*.csv

  generate_study_population_heart_rate_resp_rate:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-03-01 to 2020-04-01 by month"
      --output-file=output/input_heart_rate_resp_rate.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=heart_rate,respiratory_rate
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_heart_rate_resp_rate*.csv

  generate_study_population_ox_temp:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-03-01 to 2020-04-01 by month"
      --output-file=output/input_oxygen_saturation_temperature.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=oxygen_saturation,temperature
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_oxygen_saturation_temperature*.csv

  generate_study_population_who_dem:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-03-01 to 2020-04-01 by month"
      --output-file=output/input_who_performance_score_demographic_variables.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=who_performance_score,demographic_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_who_performance_score_demographic_variables*.csv

  generate_study_population_com_presc:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-03-01 to 2020-04-01 by month"
      --output-file=output/input_comorbidity_prescription.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=comorbidity_variables,prescription_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_comorbidity_prescription*.csv

  generate_study_population_resp:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-03-01 to 2020-04-01 by month"
      --output-file=output/input_severe_respiratory_distress_respiratory_exhaustion.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=severe_respiratory_distress,respiratory_exhaustion
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_severe_respiratory_distress_respiratory_exhaustion*.csv

  generate_study_population_conscious_level_blood_pressure_2:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-05-01 to 2020-06-01 by month"
      --output-file=output/input_conscious_level_blood_pressure.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=altered_conscious_level,blood_pressure
      --param include_hospital_admissions=True
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_conscious_level_blood_pressur*.csv

  generate_study_population_clinical_concern_dehydration_2:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-05-01 to 2020-06-01 by month"
      --output-file=output/input_clinical_concern_dehydration.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=causing_clinical_concern,clinical_concern_note,dehydration_or_shock
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_clinical_concern_dehydratio*.csv

  generate_study_population_heart_rate_resp_rate_2:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-05-01 to 2020-06-01 by month"
      --output-file=output/input_heart_rate_resp_rate.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=heart_rate,respiratory_rate
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_heart_rate_resp_rat*.csv

  generate_study_population_ox_temp_2:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-05-01 to 2020-06-01 by month"
      --output-file=output/input_oxygen_saturation_temperature.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=oxygen_saturation,temperature
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_oxygen_saturation_temperatur*.csv

  generate_study_population_who_dem_2:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-05-01 to 2020-06-01 by month"
      --output-file=output/input_who_performance_score_demographic_variables.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=who_performance_score,demographic_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_who_performance_score_demographic_variable*.csv

  generate_study_population_com_presc_2:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-05-01 to 2020-06-01 by month"
      --output-file=output/input_comorbidity_prescription.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=comorbidity_variables,prescription_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_comorbidity_prescriptio*.csv

  generate_study_population_resp_2:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-05-01 to 2020-06-01 by month"
      --output-file=output/input_severe_respiratory_distress_respiratory_exhaustion.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=severe_respiratory_distress,respiratory_exhaustion
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_severe_respiratory_distress_respiratory_exhaustio*.csv

  generate_study_population_conscious_level_blood_pressure_3:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-07-01 to 2020-08-01 by month"
      --output-file=output/input_conscious_level_blood_pressure.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=altered_conscious_level,blood_pressure
      --param include_hospital_admissions=True
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_conscious_level_blood_pressu*.csv

  generate_study_population_clinical_concern_dehydration_3:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-07-01 to 2020-08-01 by month"
      --output-file=output/input_clinical_concern_dehydration.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=causing_clinical_concern,clinical_concern_note,dehydration_or_shock
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_clinical_concern_dehydrati*.csv

  generate_study_population_heart_rate_resp_rate_3:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-07-01 to 2020-08-01 by month"
      --output-file=output/input_heart_rate_resp_rate.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=heart_rate,respiratory_rate
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_heart_rate_resp_ra*.csv

  generate_study_population_ox_temp_3:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-07-01 to 2020-08-01 by month"
      --output-file=output/input_oxygen_saturation_temperature.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=oxygen_saturation,temperature
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_oxygen_saturation_temperatu*.csv

  generate_study_population_who_dem_3:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-07-01 to 2020-08-01 by month"
      --output-file=output/input_who_performance_score_demographic_variables.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=who_performance_score,demographic_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_who_performance_score_demographic_variabl*.csv

  generate_study_population_com_presc_3:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-07-01 to 2020-08-01 by month"
      --output-file=output/input_comorbidity_prescription.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=comorbidity_variables,prescription_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_comorbidity_prescripti*.csv

  generate_study_population_resp_3:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-07-01 to 2020-08-01 by month"
      --output-file=output/input_severe_respiratory_distress_respiratory_exhaustion.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=severe_respiratory_distress,respiratory_exhaustion
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_severe_respiratory_distress_respiratory_exhausti*.csv


  #######################

  generate_study_population_conscious_level_blood_pressure_4:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-09-01 to 2020-10-01 by month"
      --output-file=output/input_conscious_level_blood_pressure.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=altered_conscious_level,blood_pressure
      --param include_hospital_admissions=True
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_conscious_level_blood_press*.csv

  generate_study_population_clinical_concern_dehydration_4:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-09-01 to 2020-10-01 by month"
      --output-file=output/input_clinical_concern_dehydration.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=causing_clinical_concern,clinical_concern_note,dehydration_or_shock
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_clinical_concern_dehydrat*.csv

  generate_study_population_heart_rate_resp_rate_4:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-09-01 to 2020-10-01 by month"
      --output-file=output/input_heart_rate_resp_rate.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=heart_rate,respiratory_rate
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_heart_rate_resp_r*.csv

  generate_study_population_ox_temp_4:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-09-01 to 2020-10-01 by month"
      --output-file=output/input_oxygen_saturation_temperature.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=oxygen_saturation,temperature
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_oxygen_saturation_temperat*.csv

  generate_study_population_who_dem_4:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-09-01 to 2020-10-01 by month"
      --output-file=output/input_who_performance_score_demographic_variables.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=who_performance_score,demographic_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_who_performance_score_demographic_variab*.csv

  generate_study_population_com_presc_4:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-09-01 to 2020-10-01 by month"
      --output-file=output/input_comorbidity_prescription.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=comorbidity_variables,prescription_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_comorbidity_prescript*.csv

  generate_study_population_resp_4:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-09-01 to 2020-10-01 by month"
      --output-file=output/input_severe_respiratory_distress_respiratory_exhaustion.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=severe_respiratory_distress,respiratory_exhaustion
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_severe_respiratory_distress_respiratory_exhaust*.csv


  ############################

  generate_study_population_conscious_level_blood_pressure_5:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-11-01 to 2020-12-01 by month"
      --output-file=output/input_conscious_level_blood_pressure.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=altered_conscious_level,blood_pressure
      --param include_hospital_admissions=True
      --param include_numeric_variables=False
      
    outputs:
      highly_sensitive:
        cohort: output/input_conscious_level_blood_pres*.csv

  generate_study_population_clinical_concern_dehydration_5:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-11-01 to 2020-12-01 by month"
      --output-file=output/input_clinical_concern_dehydration.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=causing_clinical_concern,clinical_concern_note,dehydration_or_shock
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_clinical_concern_dehydra*.csv

  generate_study_population_heart_rate_resp_rate_5:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-11-01 to 2020-12-01 by month"
      --output-file=output/input_heart_rate_resp_rate.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=heart_rate,respiratory_rate
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_heart_rate_resp_*.csv

  generate_study_population_ox_temp_5:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-11-01 to 2020-12-01 by month"
      --output-file=output/input_oxygen_saturation_temperature.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=oxygen_saturation,temperature
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_oxygen_saturation_tempera*.csv

  generate_study_population_who_dem_5:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-11-01 to 2020-12-01 by month"
      --output-file=output/input_who_performance_score_demographic_variables.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=who_performance_score,demographic_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_who_performance_score_demographic_varia*.csv

  generate_study_population_com_presc_5:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-11-01 to 2020-12-01 by month"
      --output-file=output/input_comorbidity_prescription.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=comorbidity_variables,prescription_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_comorbidity_prescrip*.csv

  generate_study_population_resp_5:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2020-11-01 to 2020-12-01 by month"
      --output-file=output/input_severe_respiratory_distress_respiratory_exhaustion.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=severe_respiratory_distress,respiratory_exhaustion
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_severe_respiratory_distress_respiratory_exhaus*.csv

  ####################

  generate_study_population_conscious_level_blood_pressure_6:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-01-01 to 2021-02-01 by month"
      --output-file=output/input_conscious_level_blood_pressure.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=altered_conscious_level,blood_pressure
      --param include_hospital_admissions=True
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_conscious_level_blood_pre*.csv

  generate_study_population_clinical_concern_dehydration_6:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-01-01 to 2021-02-01 by month"
      --output-file=output/input_clinical_concern_dehydration.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=causing_clinical_concern,clinical_concern_note,dehydration_or_shock
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_clinical_concern_dehydr*.csv

  generate_study_population_heart_rate_resp_rate_6:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-01-01 to 2021-02-01 by month"
      --output-file=output/input_heart_rate_resp_rate.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=heart_rate,respiratory_rate
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_heart_rate_resp*.csv

  generate_study_population_ox_temp_6:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-01-01 to 2021-02-01 by month"
      --output-file=output/input_oxygen_saturation_temperature.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=oxygen_saturation,temperature
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_oxygen_saturation_temper*.csv

  generate_study_population_who_dem_6:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-01-01 to 2021-02-01 by month"
      --output-file=output/input_who_performance_score_demographic_variables.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=who_performance_score,demographic_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_who_performance_score_demographic_vari*.csv

  generate_study_population_com_presc_6:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-01-01 to 2021-02-01 by month"
      --output-file=output/input_comorbidity_prescription.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=comorbidity_variables,prescription_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_comorbidity_prescri*.csv

  generate_study_population_resp_6:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-01-01 to 2021-02-01 by month"
      --output-file=output/input_severe_respiratory_distress_respiratory_exhaustion.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=severe_respiratory_distress,respiratory_exhaustion
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_severe_respiratory_distress_respiratory_exhau*.csv

  ###################


  generate_study_population_conscious_level_blood_pressure_7:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-03-01 to 2021-04-01 by month"
      --output-file=output/input_conscious_level_blood_pressure.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=altered_conscious_level,blood_pressure
      --param include_hospital_admissions=True
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_conscious_level_blood_pr*.csv

  generate_study_population_clinical_concern_dehydration_7:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-03-01 to 2021-04-01 by month"
      --output-file=output/input_clinical_concern_dehydration.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=causing_clinical_concern,clinical_concern_note,dehydration_or_shock
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_clinical_concern_dehyd*.csv

  generate_study_population_heart_rate_resp_rate_7:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-03-01 to 2021-04-01 by month"
      --output-file=output/input_heart_rate_resp_rate.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=heart_rate,respiratory_rate
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_heart_rate_res*.csv

  generate_study_population_ox_temp_7:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-03-01 to 2021-04-01 by month"
      --output-file=output/input_oxygen_saturation_temperature.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=oxygen_saturation,temperature
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_oxygen_saturation_tempe*.csv

  generate_study_population_who_dem_7:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-03-01 to 2021-04-01 by month"
      --output-file=output/input_who_performance_score_demographic_variables.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=who_performance_score,demographic_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_who_performance_score_demographic_var*.csv

  generate_study_population_com_presc_7:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-03-01 to 2021-04-01 by month"
      --output-file=output/input_comorbidity_prescription.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=comorbidity_variables,prescription_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_comorbidity_presc*.csv

  generate_study_population_resp_7:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-03-01 to 2021-04-01 by month"
      --output-file=output/input_severe_respiratory_distress_respiratory_exhaustion.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=severe_respiratory_distress,respiratory_exhaustion
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_severe_respiratory_distress_respiratory_exha*.csv

  ###################

  generate_study_population_conscious_level_blood_pressure_8:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-05-01 to 2021-06-01 by month"
      --output-file=output/input_conscious_level_blood_pressure.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=altered_conscious_level,blood_pressure
      --param include_hospital_admissions=True
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_conscious_level_blood_p*.csv

  generate_study_population_clinical_concern_dehydration_8:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-05-01 to 2021-06-01 by month"
      --output-file=output/input_clinical_concern_dehydration.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=causing_clinical_concern,clinical_concern_note,dehydration_or_shock
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_clinical_concern_dehy*.csv

  generate_study_population_heart_rate_resp_rate_8:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-05-01 to 2021-06-01 by month"
      --output-file=output/input_heart_rate_resp_rate.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=heart_rate,respiratory_rate
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_heart_rate_re*.csv

  generate_study_population_ox_temp_8:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-05-01 to 2021-06-01 by month"
      --output-file=output/input_oxygen_saturation_temperature.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=oxygen_saturation,temperature
      --param include_hospital_admissions=False
      --param include_numeric_variables=True
    outputs:
      highly_sensitive:
        cohort: output/input_oxygen_saturation_temp*.csv

  generate_study_population_who_dem_8:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-05-01 to 2021-06-01 by month"
      --output-file=output/input_who_performance_score_demographic_variables.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=who_performance_score,demographic_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_who_performance_score_demographic_va*.csv

  generate_study_population_com_presc_8:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-05-01 to 2021-06-01 by month"
      --output-file=output/input_comorbidity_prescription.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=comorbidity_variables,prescription_variables
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_comorbidity_pres*.csv

  generate_study_population_resp_8:
    run: >
      cohortextractor:latest generate_cohort
      --study-definition study_definition
      --index-date-range "2021-05-01 to 2021-06-01 by month"
      --output-file=output/input_severe_respiratory_distress_respiratory_exhaustion.csv
      --output-format=csv
      --with-end-date-fix
      --param varset=severe_respiratory_distress,respiratory_exhaustion
      --param include_hospital_admissions=False
      --param include_numeric_variables=False
    outputs:
      highly_sensitive:
        cohort: output/input_severe_respiratory_distress_respiratory_exh*.csv


  ###################
  generate_study_population_end:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_end --output-format=csv --with-end-date-fix
    outputs:
      highly_sensitive:
        cohort: output/input_end.csv

  join_cohorts:
    run: python:latest python analysis/analysis/join_cohorts.py --input-dir=output --output-dir=output/joined
    needs: [
    
      generate_study_population_conscious_level_blood_pressure_6,
      generate_study_population_clinical_concern_dehydration_6,
      generate_study_population_heart_rate_resp_rate_6,
      generate_study_population_ox_temp_6,
      generate_study_population_who_dem_6,
      generate_study_population_com_presc_6,
      generate_study_population_resp_6,
     
      ]
    outputs:
      highly_sensitive:
        counts: output/joined/input_*.csv

  join_cohorts_end:
    run: >
      cohort-joiner:v0.0.44
        --lhs output/joined/input_*.csv
        --rhs output/input_end.csv
        --output-dir output/joined/full
    needs: [
      join_cohorts,
      generate_study_population_end
      ]
    outputs:
      highly_sensitive:
        cohort: output/joined/full/input*.csv

  cohort_description:
    run: >
      python:latest python analysis/analysis/cohort_description.py
        --study_def_paths "output/joined/full/input_*.csv"
        --demographics "sex" "imdQ5" "ethnicity" "age_band" "homeless" "residential_care" "region" "asthma" "addisons_hypoadrenalism" "chronic_heart_disease" "chronic_respiratory_disease" "chronic_kidney_disease" "renal_disease" "liver_disease" "pregnant" "diabetes" "gestational_diabetes" "mental_illness" "neurological_disorder" "hypertension" "pneumonia" "immunosuppression_disorder" "immunosuppression_chemo" "immunosuppression_medication" "splenic_disease" "statins"
    needs: [join_cohorts_end]
    outputs:
      moderately_sensitive:
        counts: output/cohort_description.csv
        counts_redacted: output/cohort_description_redacted.csv

  combined_input_files:
    run: python:latest python analysis/analysis/combine_input_files.py
    needs: [join_cohorts_end]
    outputs:
      highly_sensitive:
        attrition: output/joined/full/input_all.csv

  population_count:
    run: python:latest python analysis/analysis/population_count.py
    needs: [combined_input_files]
    outputs:
      moderately_sensitive:
        count: output/joined/full/population_count.csv

  column_counts:
    run: python:latest python analysis/analysis/column_counts.py
    needs: [combined_input_files]
    outputs:
      moderately_sensitive:
        attrition: output/column_counts*

  numeric_values_check:
    run: python:latest python analysis/analysis/check_numeric_values.py
    needs: [combined_input_files]
    outputs:
      moderately_sensitive:
        table: output/joined/full/proportions_numeric.csv

  template_frequency:
    run: python:latest python analysis/analysis/template_frequency.py
    needs: [combined_input_files]
    outputs:
      moderately_sensitive:
        attrition: output/joined/full/template_frequency.csv
        
  # generate_first_outputs:
  #   run: r:latest analysis/flucats_descriptive_basic.R
  #   needs: [combined_input_files]
  #   outputs:
  #     moderately_sensitive:
  #       attrition: output/attrition.csv
  #       histogram_age: output/age_hist.png
  #       date_plot: output/weekly_template.png
  #       flucat_tables: output/flucat*.csv
  #       sex_table: output/sex_table.csv
  #       region_table: output/region_table.csv


  